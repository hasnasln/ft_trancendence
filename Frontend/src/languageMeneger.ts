const en = {
	"singin": {
	  "title": "Sign In",
	  "register": "Register",
	  "email": "Email",
	  "password": "Password",
	  "login": "Login"
	},
	"register": {
	  "title": "Register",
	  "singin": "Sign In",
	  "name": "Name",
	  "surname": "Surname",
	  "username": "Username",
	  "email": "Email",
	  "password": "Password",
	  "confirmPassword": "Confirm Password",
	  "register": "Register"
	},
	"home": {
	  "play": "Play Now",
	  "settings": "Settings",
	  "profile": "Profile",
	  "logout": "Logout"
	},
	"settings": {
	  "title": "Settings",
	  "ball-color": "Ball Color",
	  "background-color": "Background Color",
	  "player-one-color": "Player 1 Color",
	  "player-two-color": "Player 2 Color",
	  "language-select": "Language Selection",
	  "save-button": "Save",
	},
	"profile": {
	  "title": "Profile Settings",
	  "username": "Username",
	  "profile-settings": "Profile Settings",
	  "history": "Game History"
	},
	"profile-settings": {
	  "username": "Username",
	  "username-placeholder": "New Username",
	  "email": "Email",
	  "email-placeholder": "New Email",
	  "password": "Password",
	  "password-placeholder": "New Password",
	  "confirmPassword": "Confirm Password",
	  "confirmPassword-placeholder": "Confirm New Password",
	  "update": "Update"
	},
	"tournament": {
		"title": "Tournament",
		"input": "Enter Tournament Name",
		"input2": "Enter Number of Players",
		"button": "Create Tournament"
	  }
  }

const tr  = {
		"singin": {
			"title": "Giriş Yap",
			"register": "Kayıt Ol",
			"email": "E-posta",
			"password": "Şifre",
			"login": "Giriş Yap"
		},
		"singin-success": "Giriş başarılı! Yönlendiriliyorsunuz...",
		"singin-errors": {
			"required": {
				"email": "E-posta gerekli",
				"password": "Şifre gerekli"
			},
			"INVALID_CREDENTIALS": "Geçersiz e-posta veya şifre",
			"serverError": "Sunucu hatası, lütfen daha sonra tekrar deneyin"
		},
		"register": {
			"title": "Kayıt Ol",
			"singin": "Giriş Yap",
			"name": "İsim",
			"surname": "Soyisim",
			"username": "Kullanıcı Adı",
			"email": "E-posta",
			"password": "Şifre",
			"confirmPassword": "Şifreyi Onayla",
			"register": "Kayıt Ol"
		},
		"register-success": "Kayıt başarılı! Lütfen giriş yapın.",
		"register-errors": {
			"required": {
				"name": "İsim gerekli",
				"surname": "Soyisim gerekli",
				"username": "Kullanıcı adı gerekli",
				"email": "E-posta gerekli",
				"password": "Şifre gerekli",
				"confirmPassword": "Şifreyi onayla gerekli"
			},
			"minlength": {
				"name": "İsim en az 3 karakter olmalıdır",
				"surname": "Soyisim en az 3 karakter olmalıdır",
				"username": "Kullanıcı adı en az 3 karakter olmalıdır",
				"password": "Şifre en az 6 karakter olmalıdır",
				"confirmPassword": "Şifreyi onayla en az 6 karakter olmalıdır"
			},
			"maxlength": {
				"username": "Kullanıcı adı en fazla 20 karakter olmalıdır",
				"password": "Şifre en fazla 20 karakter olmalıdır"
			},
			"invalidCharacters": {
				"username": "Geçersiz username karakterleri (a-zA-Z0-9_.)",
				"email": "Geçersiz e-posta formatı"
			},
			"passwordMismatch": "Şifreler eşleşmiyor",
			"exists": {
				"username": "Bu kullanıcı adı zaten alınmış",
				"email": "Bu e-posta zaten kayıtlı"
			},
			"serverError": "Sunucu hatası, lütfen daha sonra tekrar deneyin"
		},
	
		"home":{
			"play": "Şimdi Oyna",
			"settings": "Ayarlar",
			"profile": "Profil",
			"tournament": "Turnuva",
			"logout": "Çıkış Yap"
		},
		"settings": {
			"title": "Ayarlar",
			"ball-color": "Top Rengi",
			"background-color": "Arka Plan Rengi",
			"player-one-color": "1. Oyuncu Rengi",
			"player-two-color": "2. Oyuncu Rengi",
			"language-select": "Dil Seçimi",
			"save-button": "Ayarları Kaydet"
		},
		"profile": {
			"title": "Profil Ayarları",
			"username": "Kullanıcı Adı",
			"profile-settings": "Profil Ayarları",
			"history": "Oyun Geçmişi"
		},
		"profile-settings": {
			"username": "Kullanıcı Adı",
			"username-placeholder": "Yeni Kullanıcı Adı",
			"email": "E-posta",
			"email-placeholder": "Yeni E-posta",
			"password": "Şifre",
			"password-placeholder": "Yeni Şifre",
			"confirmPassword": "Şifreyi Onayla",
			"confirmPassword-placeholder": "Yeni Şifreyi Onayla",
			"update": "Güncelle"
		},
		"tournament": {
			"first-page": {
				"title": "Turnuva",
				"description": "Aşağıdaki kısma id girip katıl butonuna tıklarsanız oda arayacak, isim girip oluştur derseniz oda oluşturacak",
				"input-placeholder": "Turnuva ID - Oda Adı",
				"create": "Turnuva Oluştur",
				"join": "Turnuvaya Katıl"
			},
			"second-page":{
				"exit": "Turnuvadan Çık",
				"tournament-id": "Turnuva ID",
				"tournament-name": "Turnuva Adı",
				"tournament-creater": "Turnuva Oluşturan",
				"tournament-total-players": "Toplam Oyuncu",
				"tournament-joined-players": "Katılan Oyuncular",
				"play": "Oyna"
			}
		}
}


const fr = {
	"singin": {
	  "title": "Se Connecter",
	  "register": "S'inscrire",
	  "email": "E-mail",
	  "password": "Mot de passe",
	  "login": "Connexion"
	},
	"register": {
	  "title": "S'inscrire",
	  "singin": "Se Connecter",
	  "name": "Prénom",
	  "surname": "Nom",
	  "username": "Nom d'utilisateur",
	  "email": "E-mail",
	  "password": "Mot de passe",
	  "confirmPassword": "Confirmer le mot de passe",
	  "register": "S'inscrire"
	},
	"home": {
	  "play": "Jouer Maintenant",
	  "settings": "Paramètres",
	  "profile": "Profil",
	  "logout": "Déconnexion"
	},
	"settings": {
	  "title": "Paramètres",
	  "ball-color": "Couleur de la Balle",
	  "background-color": "Couleur de Fond",
	  "player-one-color": "Couleur Joueur 1",
	  "player-two-color": "Couleur Joueur 2",
	  "language-select": "Sélection de la Langue",
	  "save-button": "Enregistrer"
	},
	"profile": {
	  "title": "Paramètres du Profil",
	  "username": "Nom d'utilisateur",
	  "profile-settings": "Paramètres du Profil",
	  "history": "Historique des Parties"
	},
	"profile-settings": {
	  "username": "Nom d'utilisateur",
	  "username-placeholder": "Nouveau nom d'utilisateur",
	  "email": "E-mail",
	  "email-placeholder": "Nouvel e-mail",
	  "password": "Mot de passe",
	  "password-placeholder": "Nouveau mot de passe",
	  "confirmPassword": "Confirmer le mot de passe",
	  "confirmPassword-placeholder": "Confirmer le nouveau mot de passe",
	  "update": "Mettre à jour"
	}
  }



type TranslationObject = {
	[key: string]: string | TranslationObject;
}

type LanguageChangeListener = (language: string) => void;

export class LanguageManager
{
	private static instance: LanguageManager;
	private language: string;
	private languageData: Map<string, TranslationObject>;
	private listeners: LanguageChangeListener[];
	private loading: boolean;
	private loadPromise: Promise<void> | null;
	private languageChoises: string[];

	private constructor() {
		this.language = localStorage.getItem('language') ||'tr'; // Default language
		this.languageChoises = ['tr', 'en', 'fr']; // Available languages
		this.languageData = new Map();
		this.listeners = [];
		this.loading = false;
		this.loadPromise = null;
		
		console.log('languageManager instance created');
		localStorage.setItem('language', this.language); // Store the default language in local storage
		this.loadLanguageData(this.language);
	}

	public static getInstance(): LanguageManager {
		if (!LanguageManager.instance) { // sadece ilk defa çağırıldığında instance oluştur , tek bir nesne geriye kalan her yerde kullanılacak
			LanguageManager.instance = new LanguageManager();
		}
		return LanguageManager.instance;
	}

	/*-----Burada yapmamız gereken eklediğimiz eventleri listeye almak ve her birini sonrasında çağırmak---*/
	public addLanguageChangeListener(listener: LanguageChangeListener): void {
		this.listeners.push(listener);
	}

	public removeLanguageChangeListener(listener: LanguageChangeListener): void {
		const index = this.listeners.indexOf(listener);
		if (index !== -1) {
			this.listeners.splice(index, 1);
		}
	}

	public async setLanguage(language: string): Promise<void> {
		if (this.language === language) return; // No change in language

		this.language = language;
		localStorage.setItem('language', language); // Store the selected language in local storage

		// console.log('3 saniyede');
		// 3 saniye bekle
		// await new Promise(resolve => setTimeout(resolve, 3000));
		

		await this.loadLanguageData(language); // Load the new language data
		// console.log('dil değişimi bildiriliyor');
		this.notifyLanguageChange(); // Notify all listeners about the language change
		// console.log('notify bitti');
		// await new Promise(resolve => setTimeout(resolve, 3000));
	}

	//! notiy -> bildirmek
	private notifyLanguageChange(): void {
		// console.log('notifyLanguageChange çalıştı');
		// console.log(this.listeners.length);
		// let i = 0;
		for (const listener of this.listeners) {
			listener(this.language);
			// i++;
		}
		console.log(`notifyLanguageChange: ${this.listeners.length} dinleyiciye bildirim gönderildi.`);
		// console.log('notifyLanguageChange tamamlandı');
		// console.log('i: ' + i);
	}

	private async loadLanguageData(language: string) {
		if (this.loading) {
			if (this.loadPromise) {
				await this.loadPromise;
			}
			return;
		}

		this.loading = true;
		this.loadPromise = new Promise(async (resolve) => {
			if (language === 'tr')
				this.languageData.set(language, tr); // Set default language data
			else if (language === 'en')
				this.languageData.set(language, en); // Set default language data
			else
				this.languageData.set(language, fr); // Set default language data
			this.loading = false;
			resolve();
			//! aşağıdaki istek yerine şimidlik yukarıdaki nesneleri çekip kullanalım
			// try {
			// 	const response = await fetch(`./languages/${language}.json`);
			// 	if (!response.ok) {
			// 		throw new Error(`Error fetching language data: ${response.statusText}`);
			// 	}
			// 	const data = await response.json();
			// 	this.languageData.set(language, data);
			// 	this.notifyLanguageChange();
			// } catch (error) {
			// 	console.error(error);
			// } finally {
			// 	this.loading = false;
			// 	this.loadPromise = null;
			// 	resolve();
			// }
		});
		await this.loadPromise;
		// console.log('dil ayarlandi, bir sonraki dinleyicilere yönlendirme yapılıyor');
		// await new Promise(resolve => setTimeout(resolve, 3000));
		// ! sayfa içerisinde eventlerin çalışmamasının nedeni aşağıdaki satırın hem burada hem de 
		// ! bunu fonsiyonu çağıran fonsiyonun hemen altında kullanılması
		// this.notifyLanguageChange();
	}

	public getLanguage(): string {
		return this.language;
	}

	public getLanguageChoises(): string[] {
		return this.languageChoises;
	}

	public getLang(key: string): string {
		if (this.loading) {
			return "Loading..."; // Return a loading message if data is still being fetched
		}
		const data = this.languageData.get(this.language);
		if (!data) {
			return key; // Return the key itself if language data is not available
		}

		const keys = key.split('.');
		let currentData: any = data;

		for (let i = 0; i < keys.length; i++) {
			const k = keys[i];

			if (currentData[k] === undefined) {
				return key; // Return the key itself if the translation is not found
			}

			currentData = currentData[k];
			
			if (i === keys.length - 1 && typeof currentData === 'string') {
				return currentData; // Return the translation if it's a string
			}
		}
		return key; // Return the key itself if the translation is not found
	}

	public async waitForLoad(): Promise<void> {
		if (this.loadPromise) {
			await this.loadPromise;
		}

		return Promise.resolve();
	}
}

export const exmp = LanguageManager.getInstance();